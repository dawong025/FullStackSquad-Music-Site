{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Gain } from \"../../core/context/Gain\";\nimport { optionsFromArguments } from \"../../core/util/Defaults\";\nimport { readOnly } from \"../../core/util/Interface\";\nimport { AudioToGain } from \"../../signal/AudioToGain\";\nimport { Multiply } from \"../../signal/Multiply\";\nimport { Source } from \"../Source\";\nimport { Oscillator } from \"./Oscillator\";\nimport { generateWaveform } from \"./OscillatorInterface\";\n/**\n * An amplitude modulated oscillator node. It is implemented with\n * two oscillators, one which modulators the other's amplitude\n * through a gain node.\n * ```\n *    +-------------+       +----------+\n *    | Carrier Osc +>------> GainNode |\n *    +-------------+       |          +--->Output\n *                      +---> gain     |\n * +---------------+    |   +----------+\n * | Modulator Osc +>---+\n * +---------------+\n * ```\n * @example\n * return Tone.Offline(() => {\n * \tconst amOsc = new Tone.AMOscillator(30, \"sine\", \"square\").toDestination().start();\n * }, 0.2, 1);\n * @category Source\n */\n\nexport class AMOscillator extends Source {\n  constructor() {\n    super(optionsFromArguments(AMOscillator.getDefaults(), arguments, [\"frequency\", \"type\", \"modulationType\"]));\n    this.name = \"AMOscillator\";\n    /**\n     * convert the -1,1 output to 0,1\n     */\n\n    this._modulationScale = new AudioToGain({\n      context: this.context\n    });\n    /**\n     * the node where the modulation happens\n     */\n\n    this._modulationNode = new Gain({\n      context: this.context\n    });\n    const options = optionsFromArguments(AMOscillator.getDefaults(), arguments, [\"frequency\", \"type\", \"modulationType\"]);\n    this._carrier = new Oscillator({\n      context: this.context,\n      detune: options.detune,\n      frequency: options.frequency,\n      onstop: () => this.onstop(this),\n      phase: options.phase,\n      type: options.type\n    });\n    this.frequency = this._carrier.frequency, this.detune = this._carrier.detune;\n    this._modulator = new Oscillator({\n      context: this.context,\n      phase: options.phase,\n      type: options.modulationType\n    });\n    this.harmonicity = new Multiply({\n      context: this.context,\n      units: \"positive\",\n      value: options.harmonicity\n    }); // connections\n\n    this.frequency.chain(this.harmonicity, this._modulator.frequency);\n\n    this._modulator.chain(this._modulationScale, this._modulationNode.gain);\n\n    this._carrier.chain(this._modulationNode, this.output);\n\n    readOnly(this, [\"frequency\", \"detune\", \"harmonicity\"]);\n  }\n\n  static getDefaults() {\n    return Object.assign(Oscillator.getDefaults(), {\n      harmonicity: 1,\n      modulationType: \"square\"\n    });\n  }\n  /**\n   * start the oscillator\n   */\n\n\n  _start(time) {\n    this._modulator.start(time);\n\n    this._carrier.start(time);\n  }\n  /**\n   * stop the oscillator\n   */\n\n\n  _stop(time) {\n    this._modulator.stop(time);\n\n    this._carrier.stop(time);\n  }\n\n  _restart(time) {\n    this._modulator.restart(time);\n\n    this._carrier.restart(time);\n  }\n  /**\n   * The type of the carrier oscillator\n   */\n\n\n  get type() {\n    return this._carrier.type;\n  }\n\n  set type(type) {\n    this._carrier.type = type;\n  }\n\n  get baseType() {\n    return this._carrier.baseType;\n  }\n\n  set baseType(baseType) {\n    this._carrier.baseType = baseType;\n  }\n\n  get partialCount() {\n    return this._carrier.partialCount;\n  }\n\n  set partialCount(partialCount) {\n    this._carrier.partialCount = partialCount;\n  }\n  /**\n   * The type of the modulator oscillator\n   */\n\n\n  get modulationType() {\n    return this._modulator.type;\n  }\n\n  set modulationType(type) {\n    this._modulator.type = type;\n  }\n\n  get phase() {\n    return this._carrier.phase;\n  }\n\n  set phase(phase) {\n    this._carrier.phase = phase;\n    this._modulator.phase = phase;\n  }\n\n  get partials() {\n    return this._carrier.partials;\n  }\n\n  set partials(partials) {\n    this._carrier.partials = partials;\n  }\n\n  asArray() {\n    let length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1024;\n    return __awaiter(this, void 0, void 0, function* () {\n      return generateWaveform(this, length);\n    });\n  }\n  /**\n   * Clean up.\n   */\n\n\n  dispose() {\n    super.dispose();\n    this.frequency.dispose();\n    this.detune.dispose();\n    this.harmonicity.dispose();\n\n    this._carrier.dispose();\n\n    this._modulator.dispose();\n\n    this._modulationNode.dispose();\n\n    this._modulationScale.dispose();\n\n    return this;\n  }\n\n}","map":{"version":3,"mappings":"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","names":["Gain","optionsFromArguments","readOnly","AudioToGain","Multiply","Source","Oscillator","generateWaveform","AMOscillator","constructor","getDefaults","arguments","context","options","_carrier","detune","frequency","onstop","phase","type","_modulator","modulationType","harmonicity","units","value","chain","_modulationScale","_modulationNode","gain","output","Object","assign","_start","time","start","_stop","stop","_restart","restart","baseType","partialCount","partials","asArray","length","dispose"],"sourceRoot":"","sources":["../../../../Tone/source/oscillator/AMOscillator.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}